<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Patient Department Management</title>
    
    <!-- Bootstrap CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/fontawesome.all.min.css') }}" rel="stylesheet">
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dataTables.bootstrap5.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.bootstrap5.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.bootstrap5.min.css') }}">
    
    <style>
        /* Custom styles for icons */
        .table td {
            vertical-align: middle;
        }
        
        .table i[title] {
            cursor: help;
            transition: transform 0.2s ease;
        }
        
        .table i[title]:hover {
            transform: scale(1.2);
        }
        
        .btn-group-sm .btn {
            padding: 0.25rem 0.4rem;
            font-size: 0.875rem;
        }
        
        .table-responsive {
            border-radius: 0.375rem;
            overflow: hidden;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            /* Force horizontal scrolling on mobile */
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Mobile responsive improvements */
        @media (max-width: 768px) {
            .table-responsive {
                /* Ensure horizontal scrolling */
                overflow-x: scroll;
                width: 100%;
                max-width: 100%;
            }
            
            #patient-departments-table {
                /* Prevent table from shrinking too much */
                min-width: 800px;
                font-size: 0.85rem;
            }
            
            #patient-departments-table th,
            #patient-departments-table td {
                /* Prevent text wrapping in cells */
                white-space: nowrap;
                padding: 0.5rem 0.3rem;
            }
            
            /* Make action buttons smaller on mobile */
            .btn-group-sm .btn {
                padding: 0.15rem 0.3rem;
                font-size: 0.75rem;
            }
            
            /* Adjust modal for mobile */
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
            
            /* Responsive filters */
            .col-md-3 {
                margin-bottom: 0.5rem;
            }
        }
        
        /* Small mobile devices */
        @media (max-width: 576px) {
            #patient-departments-table {
                min-width: 700px;
                font-size: 0.8rem;
            }
            
            .container-fluid {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            /* Stack filters vertically on very small screens */
            .row.mb-3 .col-md-3 {
                margin-bottom: 0.75rem;
            }
        }
        
        /* Ensure scrollbar is visible */
        .table-responsive::-webkit-scrollbar {
            height: 8px;
        }
        
        .table-responsive::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .table-responsive::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .table-responsive::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Touch-friendly improvements */
        .btn {
            min-height: 44px; /* Minimum touch target size */
        }
        
        .btn-sm {
            min-height: 38px;
            min-width: 38px;
        }
        
        /* DataTables responsive improvements */
        .dtr-details {
            background-color: #f8f9fa;
            border-left: 3px solid #007bff;
            padding: 1rem;
        }
        
        .dtr-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        /* Improve touch targets for DataTables controls */
        .dataTables_paginate .paginate_button {
            min-height: 44px !important;
            min-width: 44px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .dataTables_length select,
        .dataTables_filter input {
            min-height: 38px;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-lg-8 col-md-7">
                <h1><i class="fas fa-users-medical"></i> Danh sách người bệnh ở các khoa</h1>
                <p class="text-muted">Quản lý vào khoa</p>
            </div>
            <div class="col-lg-4 col-md-5 text-end">
                <a href="/department_patients" class="btn btn-outline-primary">
                    <i class="fas fa-hospital"></i> Xem theo khoa
                </a>
            </div>
        </div>

                <!-- Filters and Controls -->
        <div class="row mb-3">
            <div class="col-lg-4 col-md-6 col-sm-6 mb-2">
                <label for="search-patient" class="form-label">Search Patient:</label>
                <input type="text" id="search-patient" class="form-control" placeholder="Search by name or ID...">
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6 mb-2">
                <label for="filter-department" class="form-label">Filter by Department:</label>
                <select id="filter-department" class="form-select">
                    <option value="">All Departments</option>
                </select>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6 mb-2">
                <label for="filter-current" class="form-label">Filter by Status:</label>
                <select id="filter-current" class="form-select">
                    <option value="">All Status</option>
                    <option value="1">Đang nằm viện</option>
                    <option value="0">Đã ra viện</option>
                </select>
            </div>
        </div>

        <!-- Data Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table id="patient-departments-table" class="table table-striped table-hover mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Mã</th>
                                        <th>Họ tên</th>
                                        <th>Tuổi</th>
                                        <th>Giới</th>
                                        <th>Khoa</th>
                                        <th>Đang nằm</th>
                                        <th>Ngày vào</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Assignment Modal -->
    <div class="modal fade" id="assignmentModal" tabindex="-1" aria-labelledby="assignmentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="assignmentModalLabel">Quản lý vào khoa cho bệnh nhân</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Patient Info Display -->
                    <div class="alert alert-info mb-3" id="patient-info-display" style="display: none;">
                        <h6 class="mb-2"><i class="fas fa-user"></i> Thông tin bệnh nhân</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>Mã:</strong> <span id="display-patient-id">-</span><br>
                                <strong>Họ tên:</strong> <span id="display-patient-name">-</span>
                            </div>
                            <div class="col-md-6">
                                <strong>Tuổi:</strong> <span id="display-patient-age">-</span><br>
                                <strong>Giới:</strong> <span id="display-patient-gender">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-success mb-3">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Hướng dẫn:</strong> Bệnh nhân có thể được chỉ định vào cùng một khoa nhiều lần trong các thời điểm khác nhau. 
                        Sử dụng form này để thêm lịch sử vào khoa mới hoặc cập nhật thông tin hiện tại.
                    </div>
                    
                    <form id="assignment-form">
                        <input type="hidden" id="edit-id" name="id">
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="patient-id" class="form-label">Mã bệnh nhân <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="patient-id" name="PatientId" required>
                            </div>
                            <div class="col-md-6">
                                <label for="department-id" class="form-label">Khoa <span class="text-danger">*</span></label>
                                <select class="form-select" id="department-id" name="DepartmentId" required>
                                    <option value="">Chọn khoa...</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="current-status" class="form-label">Trạng thái <span class="text-danger">*</span></label>
                                <select class="form-select" id="current-status" name="Current" required>
                                    <option value="">Chọn trạng thái...</option>
                                    <option value="1">Đang nằm viện</option>
                                    <option value="0">Đã ra viện</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="assigned-at" class="form-label">Thời gian vào khoa</label>
                                <input type="datetime-local" class="form-control" id="assigned-at" name="At">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Ghi chú</label>
                            <textarea class="form-control" id="notes" name="Notes" rows="3" placeholder="Ghi chú thêm về việc vào khoa..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" id="save-assignment">
                        <i class="fas fa-save"></i> Lưu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.bootstrap5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/responsive.bootstrap5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.buttons.min.js') }}"></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/patient_departments.js') }}"></script>
</body>
</html>
