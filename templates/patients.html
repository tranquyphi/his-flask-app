{% extends "base.html" %}

{% block title %}Patients - HIS{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Patients</li>
{% endblock %}

{% block page_title %}
<i class="fas fa-users me-2"></i>Patients Management
{% endblock %}

{% block header_actions %}
<button type="button" class="btn btn-success" onclick="addPatient()">
    <i class="fas fa-plus me-1"></i>
    Add New Patient
</button>
{% endblock %}

{% block content %}
<!-- Search and Filter Section -->
<div class="search-container">
    <div class="row">
        <div class="col-md-4">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fas fa-search"></i>
                </span>
                <input type="text" class="form-control" id="searchInput" placeholder="Search patients...">
            </div>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="genderFilter">
                <option value="">All Genders</option>
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
                <option value="Khác">Khác</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="departmentFilter">
                <option value="">All Departments</option>
                <!-- Will be populated by JavaScript -->
            </select>
        </div>
        <div class="col-md-2">
            <button type="button" class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                <i class="fas fa-times me-1"></i>
                Clear
            </button>
        </div>
    </div>
</div>

<!-- Patients Table -->
<div class="table-container">
    <div id="patients-table"></div>
</div>

<!-- Patient Modal -->
<div class="modal fade" id="patientModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="patientModalTitle">
                    <i class="fas fa-user me-2"></i>
                    <span id="modalTitleText">Add New Patient</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="patientForm">
                    <input type="hidden" id="patientId" name="PatientId">
                    
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h5><i class="fas fa-info-circle me-2"></i>Basic Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="patientName" class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="patientName" name="PatientName" required>
                            </div>
                            <div class="col-md-3">
                                <label for="patientGender" class="form-label">Gender *</label>
                                <select class="form-select" id="patientGender" name="PatientGender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Nam">Nam</option>
                                    <option value="Nữ">Nữ</option>
                                    <option value="Khác">Khác</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="patientAge" class="form-label">Age</label>
                                <input type="text" class="form-control" id="patientAge" name="PatientAge">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label for="patientAddress" class="form-label">Address</label>
                                <textarea class="form-control" id="patientAddress" name="PatientAddress" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Information -->
                    <div class="form-section">
                        <h5><i class="fas fa-heartbeat me-2"></i>Medical Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="allergy" class="form-label">Allergies</label>
                                <textarea class="form-control" id="allergy" name="Allergy" rows="2" placeholder="List any known allergies..."></textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="history" class="form-label">Medical History</label>
                                <textarea class="form-control" id="history" name="History" rows="2" placeholder="Previous medical conditions, surgeries..."></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label for="patientNote" class="form-label">Notes</label>
                                <textarea class="form-control" id="patientNote" name="PatientNote" rows="2" placeholder="Additional notes..."></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="savePatient()">
                    <i class="fas fa-save me-1"></i>
                    <span id="saveButtonText">Save Patient</span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/patients.js') }}"></script>
{% endblock %}
